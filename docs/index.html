<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>kaori: C++ library for counting barcodes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">kaori
   </div>
   <div id="projectbrief">A C++ library for barcode extraction and matching</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">C++ library for counting barcodes </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2github_2workspace_2README"></a> <img src="https://github.com/crisprVerse/kaori/actions/workflows/run-tests.yaml/badge.svg" alt="Unit tests" style="pointer-events: none;" class="inline"/> <img src="https://github.com/crisprVerse/kaori/actions/workflows/doxygenate.yaml/badge.svg" alt="Documentation" style="pointer-events: none;" class="inline"/> <a href="https://codecov.io/gh/crisprVerse/kaori"><img src="https://codecov.io/gh/crisprVerse/kaori/branch/master/graph/badge.svg?token=WZkuJqiGtc" alt="Codecov" style="pointer-events: none;" class="inline"/></a></p>
<h1>Overview</h1>
<p><b>kaori</b> is a header-only C++ libary for counting the frequency of barcodes in FASTQ files. We support a variety of barcode designs including single, combinatorial and dual barcodes in either single- or paired-end data. Users can specify a maximum number of mismatches for identification of the target sequence (i.e., across both the constant and variable regions). Gzipped FASTQ files can be processed, provided Zlib is available.</p>
<h1>Quick start</h1>
<p><b>kaori</b> is a header-only library, so it can be easily used by just <code>#include</code>ing the relevant source files:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="kaori_8hpp.html">kaori/kaori.hpp</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;byteme/byteme.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Defining a template and the possible choices for barcodes.</span></div>
<div class="line">std::string tmpl = <span class="stringliteral">&quot;ACGT----TGCA&quot;</span>;</div>
<div class="line">std::vector&lt;std::string&gt; choices { <span class="stringliteral">&quot;AAAA&quot;</span>, <span class="stringliteral">&quot;CCCC&quot;</span>, <span class="stringliteral">&quot;GGGG&quot;</span>, <span class="stringliteral">&quot;TTTT&quot;</span> };</div>
<div class="line"><a class="code hl_struct" href="structkaori_1_1BarcodePool.html">kaori::BarcodePool</a> pool(choices);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Configure the handler:</span></div>
<div class="line"><span class="comment">// - Maximum length of 32 bp for the template.</span></div>
<div class="line"><span class="comment">// - Search both the forward and reverse strands.</span></div>
<div class="line"><span class="comment">// - Maximum mismatch of 1.</span></div>
<div class="line"><a class="code hl_struct" href="structkaori_1_1SingleBarcodeSingleEnd_1_1Options.html">kaori::SingleBarcodeSingleEnd&lt;32&gt;::Options</a> opt;</div>
<div class="line">opt.max_mismatch = 1;</div>
<div class="line">opt.<a class="code hl_variable" href="structkaori_1_1SingleBarcodeSingleEnd_1_1Options.html#a3772722958364643cbbb9f8ca785f419">strand</a> = kaori::SearchStrand::BOTH;</div>
<div class="line"><a class="code hl_class" href="classkaori_1_1SingleBarcodeSingleEnd.html">kaori::SingleBarcodeSingleEnd&lt;32&gt;</a> handler(tmpl.c_str(), tmpl.size(), pool, opt);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Process a FASTQ file with 4 threads.</span></div>
<div class="line">byteme::SomeFileReader input(path_to_fastq);</div>
<div class="line">kaori::process_single_end(&amp;input, handler, 4);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the counts after processing.</span></div>
<div class="line">handler.get_counts();</div>
<div class="ttc" id="aclasskaori_1_1SingleBarcodeSingleEnd_html"><div class="ttname"><a href="classkaori_1_1SingleBarcodeSingleEnd.html">kaori::SingleBarcodeSingleEnd</a></div><div class="ttdoc">Handler for single-end single barcodes.</div><div class="ttdef"><b>Definition</b> SingleBarcodeSingleEnd.hpp:25</div></div>
<div class="ttc" id="akaori_8hpp_html"><div class="ttname"><a href="kaori_8hpp.html">kaori.hpp</a></div><div class="ttdoc">Umbrella includes for the kaori barcode-matching library.</div></div>
<div class="ttc" id="astructkaori_1_1BarcodePool_html"><div class="ttname"><a href="structkaori_1_1BarcodePool.html">kaori::BarcodePool</a></div><div class="ttdoc">Pool of barcode sequences for a variable region.</div><div class="ttdef"><b>Definition</b> BarcodePool.hpp:21</div></div>
<div class="ttc" id="astructkaori_1_1SingleBarcodeSingleEnd_1_1Options_html"><div class="ttname"><a href="structkaori_1_1SingleBarcodeSingleEnd_1_1Options.html">kaori::SingleBarcodeSingleEnd::Options</a></div><div class="ttdoc">Optional parameters for SingleBarcodeSingleEnd.</div><div class="ttdef"><b>Definition</b> SingleBarcodeSingleEnd.hpp:30</div></div>
<div class="ttc" id="astructkaori_1_1SingleBarcodeSingleEnd_1_1Options_html_a3772722958364643cbbb9f8ca785f419"><div class="ttname"><a href="structkaori_1_1SingleBarcodeSingleEnd_1_1Options.html#a3772722958364643cbbb9f8ca785f419">kaori::SingleBarcodeSingleEnd::Options::strand</a></div><div class="ttdeci">SearchStrand strand</div><div class="ttdef"><b>Definition</b> SingleBarcodeSingleEnd.hpp:45</div></div>
</div><!-- fragment --><p>Check out the <a href="https://crisprverse.github.io/kaori">reference documentation</a> for more details.</p>
<h1>Method description</h1>
<h2>Algorithm</h2>
<p>We define the "barcoding element" as the full sequence to be matched by <b>kaori</b>. The barcoding element is parametrized as a template that consists of constant and variable regions. Each variable region is associated with a pool of possible barcode sequences; the template can be realized into a specific sequence of a barcoding element by replacing its variable regions with valid barcode sequences.</p>
<p>Given a template sequence and the associated barcode pools, <b>kaori</b> will scan each read for the template using bitwise comparisons. If a suitable match to the template is found, the sequence of the read at each variable region is extracted and searched against the pool of known barcodes. Imperfect barcode matches are identified through a trie-based search; the total number of mismatches is summed across the constant and variable regions. <b>kaori</b> also caches information about imperfect matches to avoid a redundant look-up when the same sequence is encountered in later reads.</p>
<p>Our approach is fast and relatively easy to implement compared to full-blown sequence aligners. Any number of mismatches are supported and the framework can be easily adapted to new barcoding configurations. However, the downside is that indels are not supported in the search process. We consider this limitation to be acceptable as indels are quite rare in (Illumina) sequencing data.</p>
<h2>Defining handlers</h2>
<p>Each barcoding configuration is processed by a different <b>kaori</b> handler. The code shown above for <code>SingleBarcodeSingleEnd</code> can be re-used for different handlers:</p>
<ul>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1SingleBarcodeSingleEnd.html">Single barcodes in single-end data</a></li>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1SingleBarcodePairedEnd.html">Single barcodes in paired-end data</a></li>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1CombinatorialBarcodesSingleEnd.html">Combinatorial barcodes in single-end data</a></li>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1CombinatorialBarcodesPairedEnd.html">Combinatorial barcodes in paired-end data</a></li>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1DualBarcodesPairedEnd.html">Dual barcodes in paired-end data</a>, with <a href="https://crisprverse.github.io/kaori/classkaori_1_1DualBarcodesPairedEndWithDiagnostics.html">diagnostics</a></li>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1DualBarcodesSingleEnd.html">Dual barcodes in single-end data</a>, with <a href="https://crisprverse.github.io/kaori/classkaori_1_1DualBarcodesSingleEndWithDiagnostics.html">diagnostics</a></li>
<li><a href="https://crisprverse.github.io/kaori/classkaori_1_1RandomBarcodeSingleEnd.html">Random barcodes in single-end data</a></li>
</ul>
<p>The library exports a number of utilities to easily construct a new handler - see the <a href="https://crisprverse.github.io/kaori/process__data_8hpp.html"><code>process_data.hpp</code></a> documentation for the handler expectations. This can be used to quickly extend <b>kaori</b> to handle other configurations. If you have a configuration that is not supported here, create an issue and we'll see what we can do. (Or even better, a pull request.)</p>
<h2>Setting maximum template lengths</h2>
<p>The bitwise comparison for the constant template requires a compile-time specification of the maximum template length. In our applications, we use templating to dispatch across a set of possible template lengths. This improves efficiency for shorter templates while still retaining support for larger templates. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keywordtype">size_t</span> max_size&gt;</div>
<div class="line">std::vector&lt;int&gt; process(byteme::Reader* input, <span class="keyword">const</span> std::string&amp; tmpl, <span class="keyword">const</span> <a class="code hl_struct" href="structkaori_1_1BarcodePool.html">kaori::BarcodePool</a>&amp; pool) {</div>
<div class="line">    <a class="code hl_class" href="classkaori_1_1SingleBarcodeSingleEnd.html">kaori::SingleBarcodeSingleEnd&lt;max_size&gt;</a> handler(tmpl.c_str(), tmpl.size(), 0, pool, 1);</div>
<div class="line">    kaori::process_single_end(input, handler, 4);</div>
<div class="line">    <span class="keywordflow">return</span> handler.get_counts();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">std::vector&lt;int&gt; output;</div>
<div class="line"><span class="keywordflow">if</span> (tmpl.size() &lt;= 32) {</div>
<div class="line">    output = process&lt;32&gt;(&amp;input, tmpl)</div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">template</span>.size() &lt;= 64) {</div>
<div class="line">    output = process&lt;64&gt;(&amp;input, tmpl)</div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">template</span>.size() &lt;= 128) {</div>
<div class="line">    output = process&lt;128&gt;(&amp;input, tmpl)</div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">template</span>.size() &lt;= 256) {</div>
<div class="line">    output = process&lt;256&gt;(&amp;input, tmpl)</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;template sequence is too large&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Building projects</h1>
<h2>CMake with <code>FetchContent</code></h2>
<p>If you're using CMake, you just need to add something like this to your <code>CMakeLists.txt</code>:</p>
<div class="fragment"><div class="line">include(FetchContent)</div>
<div class="line"> </div>
<div class="line">FetchContent_Declare(</div>
<div class="line">  kaori</div>
<div class="line">  GIT_REPOSITORY https://github.com/crisprVerse/kaori</div>
<div class="line">  GIT_TAG master # or any version of interest </div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">FetchContent_MakeAvailable(kaori)</div>
</div><!-- fragment --><p>Then you can link to <b>kaori</b> to make the headers available during compilation:</p>
<div class="fragment"><div class="line"># For executables:</div>
<div class="line">target_link_libraries(myexe kaori)</div>
<div class="line"> </div>
<div class="line"># For libaries</div>
<div class="line">target_link_libraries(mylib INTERFACE kaori)</div>
</div><!-- fragment --><h2>CMake with <code>find_package()</code></h2>
<p>You can install the library by cloning a suitable version of this repository and running the following commands:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake .. -DKAORI_TESTS=OFF</div>
<div class="line">cmake --build . --target install</div>
</div><!-- fragment --><p>Then you can use <code>find_package()</code> as usual:</p>
<div class="fragment"><div class="line">find_package(crisprverse_kaori CONFIG REQUIRED)</div>
<div class="line">target_link_libraries(mylib INTERFACE crisprverse::kaori)</div>
</div><!-- fragment --><h2>Manual</h2>
<p>If you're not using CMake, the simple approach is to just copy the files - either directly or with Git submodules - and include their path during compilation with, e.g., GCC's <code>-I</code>. You'll also need to link to the <a href="https://github.com/LTLA/byteme"><b>byteme</b></a> header-only library as well as Zlib. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
